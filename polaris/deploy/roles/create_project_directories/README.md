# Ansible Role: create_project_directories

## Overview

This Ansible role manages the creation of project directories for a specified service. It ensures the required directory structure is in place, sets the current service version, and cleans up old service installation directories while retaining at least the last three versions.

## Requirements

- Ansible collection `nr-polaris-collection` installed on the system where it will be executed
- Ansible variable files generated by `[NR Repository Composer](https://github.com/bcgov-nr/nr-repository-composer)`

## Role Variables

The following variables can be configured in the role:

| Variable Name                      | Description                                             | Default Value |
|------------------------------------|---------------------------------------------------------|---------------|
| `pd_prop_service_install_directory`| Name of the service installation directory              | `null`        |
| `install_user`                     | User to perform the directory operations                | `root`        |
| `apps_home`                        | Base directory for applications                         | `/opt/apps`   |
| `apps_logs`                        | Base directory for logs                                 | `/var/log`    |
| `apps_data`                        | Base directory for application data                     | `/var/data`   |
| `s6_services`                      | Directory for S6 services                               | `/etc/s6`     |
| `pd_prop_project_name`             | Name of the project                                     | `null`        |
| `pd_prop_service_name`             | Name of the service                                     | `null`        |

## Tasks

The role performs the following tasks:

1. **Debug Service Installation Directory**: Outputs the service installation directory for verification purposes.

2. **Create Project Directories**: Creates the necessary directory structure for the project and service.

3. **Set Current Version**: Creates a symbolic link named `current` pointing to the specified version directory.

4. **Clean Up Old Service Installation Directories**: Deletes the oldest service installation directory if more than three exist.

## Example Playbook

Below is an example playbook that uses this role:

```yaml
- hosts: all
  become: yes
  vars:
    pd_prop_service_install_directory: "v1.0.0"
    install_user: "appuser"
    apps_home: "/opt/apps"
    apps_logs: "/var/log/apps"
    apps_data: "/var/data/apps"
    s6_services: "/etc/s6/services"
    pd_prop_project_name: "my_project"
    pd_prop_service_name: "my_service"
  roles:
    - role: create_project_directories
